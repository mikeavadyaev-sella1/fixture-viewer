<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Fixture QR Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f172a;
      --card:#111827;
      --accent:#22c55e;
      --accent2:#38bdf8;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --border:#1f2937;
    }

    *{box-sizing:border-box;}

    html,body{
      margin:0;
      min-height:100vh;
    }

    body{
      background:radial-gradient(circle at top, #1e293b, #020617);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      color:var(--text);
      display:flex;
      justify-content:center;
      padding:14px;
    }

.wrap{
  width:100%;
  max-width:520px;
  height:100vh;        /* ‚Üê –¥–æ–±–∞–≤–∏–ª–∏ */
  overflow:hidden;     /* ‚Üê –¥–æ–±–∞–≤–∏–ª–∏ */
  display:flex;
  flex-direction:column;
  gap:10px;
  position:relative;
}


    /* === MENU BAR === */
    .menu-bar{
      display:flex;
      flex-direction:column;
      gap:6px;
      padding:8px 10px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(15,23,42,0.95);
      box-shadow:0 16px 40px rgba(0,0,0,.4);
    }

    .menu-top{
      display:flex;
      gap:8px;
      align-items:center;
    }

    .menu-btn{
      padding:6px 12px;
      border-radius:999px;
      border:1px solid var(--accent2);
      background:#020617;
      color:var(--accent2);
      font-size:13px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }

    .menu-btn:active{ transform:translateY(1px); }

    .menu-select{
      flex:1;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#020617;
      color:var(--text);
      font-size:13px;
      outline:none;
    }

    /* manual selection ‚Äî –≥–æ–ª—É–±–æ–π —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –ø–æ–∑–≤–æ–ª–∏—Ç */
    .menu-select option[value="manual"]{
      color:var(--accent2);
    }

    /* === VIEWER === */
    .viewer-shell{
      border-radius:16px;
      border:1px solid var(--border);
      background:#111827;
      padding:10px 10px 12px;
      box-shadow:0 18px 40px rgba(0,0,0,.55);
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .section-label{
      font-size:12px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.08em;
    }

.viewer-shell{
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
  gap:6px;
  min-height:0; /* –≤–∞–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ flex-—Å–∫—Ä–æ–ª–ª–∞ */
}

.viewer-frame{
  flex:1 1 auto;       /* ‚Üê —Ç—è–Ω–µ—Ç iframe –≤–Ω–∏–∑ */
  width:100%;
  border:none;
  border-radius:10px;
  background:#020617;
  display:block;
  min-height:0;        /* ‚Üê –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ */
}

    .viewer-info{
      font-size:11px;
      color:var(--muted);
    }

    /* === SCAN MODAL === */
    .scan-backdrop{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.7);
      z-index:1000;
    }

    .scan-card{
      width:100%;
      max-width:480px;
      background:#111827;
      border-radius:16px;
      border:1px solid var(--border);
      box-shadow:0 20px 60px rgba(0,0,0,.8);
      padding:14px 14px 12px;
    }

    .scan-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }

    .scan-title{
      font-size:16px;
      font-weight:600;
    }

    .scan-close{
      border:none;
      background:transparent;
      color:var(--muted);
      cursor:pointer;
      font-size:18px;
      line-height:1;
      padding:2px 4px;
    }

    .video-wrap{
      border-radius:10px;
      border:1px solid var(--border);
      background:#020617;
      padding:6px 8px 8px;
      margin-bottom:8px;
    }

    #video{
      width:100%;
      max-height:240px;
      border-radius:8px;
      background:#000;
      display:block;
    }

    .box{
      border-radius:10px;
      border:1px solid var(--border);
      background:#020617;
      padding:6px 8px;
      font-size:11px;
      min-height:42px;
      max-height:120px;
      overflow:auto;
      white-space:pre-wrap;
      word-break:break-all;
    }

    .box.placeholder{
      color:var(--muted);
      font-style:italic;
    }

    .scan-footer{
      margin-top:8px;
      display:flex;
      justify-content:flex-end;
      gap:8px;
    }

    .scan-btn{
      padding:6px 12px;
      border-radius:999px;
      border:1px solid var(--accent);
      background:#020617;
      color:var(--accent);
      font-size:13px;
      cursor:pointer;
    }

    .scan-btn-secondary{
      border-color:var(--border);
      color:var(--muted);
    }

    .scan-btn:active{
      transform:translateY(1px);
    }

    /* === MANUAL POPUP (dropdown-like) === */
    .manual-popup{
      position:absolute;
      top:70px;          /* –ø—Ä–∏–º–µ—Ä–Ω–æ –ø–æ–¥ –º–µ–Ω—é */
      right:12px;
      min-width:220px;
      background:#020617;
      border:1px solid var(--border);
      border-radius:10px;
      box-shadow:0 18px 40px rgba(0,0,0,.7);
      display:none;
      z-index:1200;
    }

    .manual-popup-card{
      padding:8px;
    }

    .manual-popup-title{
      font-size:12px;
      color:var(--muted);
      margin-bottom:4px;
    }

    .manual-popup-list{
      max-height:220px;
      overflow:auto;
      margin:-2px;
      padding:2px;
    }

    .manual-item{
      padding:6px 8px;
      font-size:13px;
      border-radius:8px;
      cursor:pointer;
      color:var(--text);
    }

    .manual-item:hover{
      background:#111827;
    }
  </style>

  <!-- –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è QR -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
   <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#020617">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
  <div class="wrap">
    <!-- MENU BAR -->
    <div class="menu-bar">
      <div class="menu-top">
        <button id="menuScan" class="menu-btn" type="button">
          üì∑ Scan QR
        </button>
        <select id="viewerSelect" class="menu-select">
          <!-- –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
        </select>
      </div>
    </div>

    <!-- VIEWER -->
    <div class="viewer-shell">
      <iframe id="viewerFrame" class="viewer-frame" src="" title="Fixture viewer"></iframe>
      <div id="viewerInfo" class="viewer-info">
        No fixture loaded. Use manual selection to pick fixtures/&lt;name&gt;.html, then QR entries will send probes into probeInput.
      </div>
    </div>

    <!-- MANUAL SELECTION POPUP -->
    <div id="manualPopup" class="manual-popup">
      <div class="manual-popup-card">
        <div class="manual-popup-title">Select fixture from fixtures/</div>
        <div id="manualList" class="manual-popup-list"></div>
      </div>
    </div>
  </div>

  <!-- SCAN MODAL -->
  <div id="scanModal" class="scan-backdrop">
    <div class="scan-card">
      <div class="scan-header">
        <div>
          <div class="scan-title">Scan QR</div>
          <div style="font-size:11px;color:var(--muted);">Point the camera at QR code with JSON.</div>
        </div>
        <button id="scanClose" class="scan-close" type="button">√ó</button>
      </div>

      <div class="video-wrap">
        <div class="section-label" style="margin-bottom:4px;">Camera</div>
        <video id="video" playsinline></video>
      </div>

      <div class="section-label" style="margin-bottom:4px;">Raw QR data</div>
      <div id="rawBox" class="box placeholder">
        Waiting for camera‚Ä¶
      </div>

      <div class="scan-footer">
        <button id="scanStop" class="scan-btn scan-btn-secondary" type="button">Stop</button>
      </div>
    </div>
  </div>

  <script>
    const rawBox       = document.getElementById('rawBox');
    const menuScanBtn  = document.getElementById('menuScan');
    const scanModal    = document.getElementById('scanModal');
    const scanCloseBtn = document.getElementById('scanClose');
    const scanStopBtn  = document.getElementById('scanStop');
    const videoEl      = document.getElementById('video');

    const viewerSelect = document.getElementById('viewerSelect');
    const viewerFrame  = document.getElementById('viewerFrame');
    const viewerInfo   = document.getElementById('viewerInfo');

    const manualPopup  = document.getElementById('manualPopup');
    const manualList   = document.getElementById('manualList');

    let stream   = null;
    let scanRaf  = null;
    let scanning = false;

    const MANUAL_VALUE = 'manual';

    // map: "AP1264-030-3" -> { id, key, label, probes }
    const viewerMap = {};
    let fixturesCache = null; // –∫—ç—à fixtures/list.json
    let pendingProbes = null; // probes, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ –≤–ø–∏—Å–∞—Ç—å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ fixture

    function setRaw(text){
      rawBox.textContent = text;
      rawBox.classList.remove('placeholder');
    }

    function setViewerMessage(msg){
      if (viewerInfo) viewerInfo.textContent = msg;
    }

    function resetViewerSelectBase(fixturesOptions){
      viewerSelect.innerHTML = '';

      // 1) choose... (–ø–µ—Ä–≤—ã–π, –≤—ã–±—Ä–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
      const chooseOpt = document.createElement('option');
      chooseOpt.value = '';
      chooseOpt.textContent = 'choose...';
      viewerSelect.appendChild(chooseOpt);
      viewerSelect.value = '';

      // 2) fixture-–æ–ø—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
      if (Array.isArray(fixturesOptions)) {
        fixturesOptions.forEach(opt => {
          viewerSelect.appendChild(opt);
        });
      }

      // 3) manual selection (–ø–æ—Å–ª–µ–¥–Ω–∏–π)
      const manualOpt = document.createElement('option');
      manualOpt.value = MANUAL_VALUE;
      manualOpt.textContent = 'manual selection';
      viewerSelect.appendChild(manualOpt);
    }

    function collectFixtureOptions(){
      return Array.from(viewerSelect.options)
        .filter(o => o.value && o.value.startsWith('fixtures/'))
        .map(o => {
          const c = document.createElement('option');
          c.value = o.value;
          c.textContent = o.textContent;
          return c;
        });
    }

    function clearViewerFromQR(){
      Object.keys(viewerMap).forEach(k => delete viewerMap[k]);
      const fixturesOptions = collectFixtureOptions();
      resetViewerSelectBase(fixturesOptions);
      pendingProbes = null;
      setViewerMessage('No fixture loaded. Use QR or manual selection.');
    }

    function buildViewerListFromJson(rawText){
      let obj;
      try {
        obj = JSON.parse(rawText);
      } catch (e) {
        setViewerMessage('QR data is not valid JSON, viewer list not built.');
        clearViewerFromQR();
        return;
      }

      Object.keys(viewerMap).forEach(k => delete viewerMap[k]);

      const fixturesOptions = collectFixtureOptions();

      const keys = Object.keys(obj);
      const qrOptions = [];

      keys.forEach(key => {
        const arr = obj[key];
        if (!Array.isArray(arr)) return;
        arr.forEach(item => {
          const label  = (item && (item.label ?? item.l)) || '';
          const probes = (item && (item.probes ?? item.p)) || '';
          if (!label || !probes) return;
          const id = `${key}-${label}`;
          viewerMap[id] = { id, key, label, probes };
          qrOptions.push(id);
        });
      });

      // –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º select: choose + QR + fixtures + manual
      viewerSelect.innerHTML = '';

      const chooseOpt = document.createElement('option');
      chooseOpt.value = '';
      chooseOpt.textContent = 'choose...';
      viewerSelect.appendChild(chooseOpt);
      viewerSelect.value = '';

      qrOptions.forEach(id => {
        const opt = document.createElement('option');
        opt.value = id;
        opt.textContent = id;
        viewerSelect.appendChild(opt);
      });

      fixturesOptions.forEach(opt => {
        viewerSelect.appendChild(opt);
      });

      const manualOpt = document.createElement('option');
      manualOpt.value = MANUAL_VALUE;
      manualOpt.textContent = 'manual selection';
      viewerSelect.appendChild(manualOpt);

      pendingProbes = null;
      setViewerMessage('Select QR entry to load fixtures/<AP>.html and send probes into probeInput, or use manual selection for fixtures.');
    }

    function sendProbesToFixture(probes){
  if (!viewerFrame || !viewerFrame.contentWindow) return;
  try {
    const doc = viewerFrame.contentWindow.document;
    if (!doc) return;
    const input = doc.getElementById('probeInput');
    if (!input) return;

    // —Å—Ç–∞–≤–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ
    input.value = probes;

    // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∏–º–∏—Ç–∏—Ä—É–µ–º —Ä—É—á–Ω–æ–π –≤–≤–æ–¥
    try {
      const evInit = { bubbles: true, cancelable: true };

      // —Å–æ–±—ã—Ç–∏–µ input
      input.dispatchEvent(new Event("input", evInit));

      // —Å–æ–±—ã—Ç–∏–µ change
      input.dispatchEvent(new Event("change", evInit));
    } catch(e2){
      // fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –¥–≤–∏–∂–∫–æ–≤ (–Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è, –Ω–æ –ø—É—Å—Ç—å –±—É–¥–µ—Ç)
      const evtInput  = doc.createEvent("HTMLEvents");
      evtInput.initEvent("input", true, true);
      input.dispatchEvent(evtInput);

      const evtChange = doc.createEvent("HTMLEvents");
      evtChange.initEvent("change", true, true);
      input.dispatchEvent(evtChange);
    }

  } catch (e) {
    console.warn('Cannot access probeInput inside iframe:', e);
  }
}


    function onViewerSelectChange(){
      const v = viewerSelect.value;

      if (!v) {
        // choose...
        pendingProbes = null;
        return;
      }

      if (v === MANUAL_VALUE) {
        // manual selection ‚Üí popup, fixture –≤—ã–±–æ—Ä; viewer –≥—Ä—É–∑–∏–º, probes –Ω–µ —Ç—Ä–æ–≥–∞–µ–º
        openManualPopup();
        pendingProbes = null;
        return;
      }

      // –µ—Å–ª–∏ —ç—Ç–æ QR-—ç–ª–µ–º–µ–Ω—Ç
      if (viewerMap[v]) {
        const item = viewerMap[v];
        const viewerPath = 'fixtures/' + item.key + '.html';
        pendingProbes = item.probes;

        if (viewerFrame.src !== viewerPath) {
          viewerFrame.src = viewerPath;
          setViewerMessage('Loaded viewer for ' + item.key + ', waiting for load to send probes.');
          // probes —É–π–¥—É—Ç –ø–æ—Å–ª–µ onload
        } else {
          // —Ñ–∞–π–ª —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω ‚Äî –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É
          sendProbesToFixture(item.probes);
          setViewerMessage('Sent probes to existing viewer: ' + item.key);
          pendingProbes = null;
        }
        return;
      }

      // –∏–Ω–∞—á–µ —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ —ç—Ç–æ fixture (value = 'fixtures/<name>.html')
      pendingProbes = null;
      viewerFrame.src = v;
      setViewerMessage('Loaded fixture: ' + v);
    }

    /* === MANUAL POPUP === */

    function openManualPopup(){
      if (!manualPopup) return;

      if (fixturesCache) {
        fillManualPopup(fixturesCache);
        manualPopup.style.display = 'block';
        return;
      }

      fetch('fixtures/list.json', { cache: 'no-store' })
        .then(r => {
          if (!r.ok) throw new Error('HTTP ' + r.status);
          return r.json();
        })
        .then(list => {
          if (!Array.isArray(list)) throw new Error('list.json must be an array');
          fixturesCache = list;
          fillManualPopup(list);
          manualPopup.style.display = 'block';
        })
        .catch(err => {
          console.error(err);
          setViewerMessage('Cannot load fixtures/list.json');
        });
    }

    function fillManualPopup(list){
      manualList.innerHTML = '';
      if (!list.length) {
        const div = document.createElement('div');
        div.className = 'manual-item';
        div.textContent = '(no fixtures in list.json)';
        manualList.appendChild(div);
        return;
      }
      list.forEach(name => {
        const div = document.createElement('div');
        div.className = 'manual-item';
        div.textContent = name;
        div.addEventListener('click', () => {
          onFixturePicked(name);
        });
        manualList.appendChild(div);
      });
    }

    function closeManualPopup(){
      if (manualPopup) manualPopup.style.display = 'none';
    }

    function onFixturePicked(fileName){
      closeManualPopup();
      const value = 'fixtures/' + fileName;

      // —É–±—Ä–∞—Ç—å, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å
      Array.from(viewerSelect.options).forEach(opt => {
        if (opt.value === value) viewerSelect.removeChild(opt);
      });

      // —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –æ–ø—Ü–∏—é —Å —ç—Ç–∏–º fixture
      const opt = document.createElement('option');
      opt.value = value;
      opt.textContent = fileName;

      // –≤—Å—Ç–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ choose... (–∏–Ω–¥–µ–∫—Å 0)
      if (viewerSelect.children.length > 0) {
        viewerSelect.insertBefore(opt, viewerSelect.children[1] || null);
      } else {
        viewerSelect.appendChild(opt);
      }

      // —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ manual selection –ø–æ—Å–ª–µ–¥–Ω–∏–º
      let manualOpt = Array.from(viewerSelect.options).find(o => o.value === MANUAL_VALUE);
      if (!manualOpt) {
        manualOpt = document.createElement('option');
        manualOpt.value = MANUAL_VALUE;
        manualOpt.textContent = 'manual selection';
        viewerSelect.appendChild(manualOpt);
      } else {
        viewerSelect.removeChild(manualOpt);
        viewerSelect.appendChild(manualOpt);
      }

      // –≤—ã–±—Ä–∞—Ç—å fixture –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ
      viewerSelect.value = value;
      onViewerSelectChange();
    }

    // –∫–ª–∏–∫ –≤–Ω–µ popup ‚Äî –∑–∞–∫—Ä—ã—Ç—å
    document.addEventListener('click', (e) => {
      if (!manualPopup) return;
      if (manualPopup.style.display !== 'block') return;
      const target = e.target;
      if (manualPopup.contains(target)) return;
      if (target === viewerSelect) return;
      closeManualPopup();
    });

    /* === SCAN === */

    function stopScan(){
      scanning = false;
      if (scanRaf) {
        cancelAnimationFrame(scanRaf);
        scanRaf = null;
      }
      if (stream) {
        stream.getTracks().forEach(t => t.stop());
        stream = null;
      }
    }

    function closeScanModal(){
      stopScan();
      if (scanModal) scanModal.style.display = 'none';
    }

    function openScanModal(){
      if (!scanModal) return;
      scanModal.style.display = 'flex';
      startScan();
    }

    function tickScan(){
      if (!scanning) return;
      if (videoEl.readyState === videoEl.HAVE_ENOUGH_DATA) {
        const w = videoEl.videoWidth;
        const h = videoEl.videoHeight;
        if (w && h) {
          const canvas = document.createElement('canvas');
          canvas.width = w;
          canvas.height = h;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(videoEl, 0, 0, w, h);
          const imgData = ctx.getImageData(0, 0, w, h);
          const code = jsQR(imgData.data, imgData.width, imgData.height, {
            inversionAttempts: 'dontInvert'
          });
          if (code && code.data) {
            const text = code.data;
            setRaw(text);                   // —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
            buildViewerListFromJson(text);  // QR-–æ–ø—Ü–∏–∏ –≤ select
            closeScanModal();               // –∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ —Å–∫–∞–Ω–µ—Ä–∞
            return;
          }
        }
      }
      scanRaf = requestAnimationFrame(tickScan);
    }

    async function startScan(){
      if (scanning) {
        return;
      }

      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert('Camera access is not supported in this browser.');
        return;
      }

      try {
        rawBox.classList.add('placeholder');
        rawBox.textContent = 'Scanning‚Ä¶ Point the camera at QR code.';

        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment' }
        });

        videoEl.srcObject = stream;
        videoEl.setAttribute('playsinline', 'true');

        await videoEl.play();

        scanning = true;
        tickScan();
      } catch (e) {
        console.error(e);
        stopScan();
        rawBox.classList.add('placeholder');
        rawBox.textContent = 'Cannot start camera. Check permissions.';
      }
    }

    /* === EVENTS === */
    menuScanBtn.addEventListener('click', () => {
      openScanModal();
    });

    scanCloseBtn.addEventListener('click', () => {
      closeScanModal();
    });

    scanStopBtn.addEventListener('click', () => {
      closeScanModal();
    });

    viewerSelect.addEventListener('change', onViewerSelectChange);

    window.addEventListener('beforeunload', () => {
      stopScan();
    });

    // –∫–æ–≥–¥–∞ iframe –∑–∞–≥—Ä—É–∑–∏–ª fixture ‚Äî –µ—Å–ª–∏ –µ—Å—Ç—å pendingProbes, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏—Ö
    viewerFrame.addEventListener('load', () => {
      if (pendingProbes != null) {
        sendProbesToFixture(pendingProbes);
        setViewerMessage('Sent probes to probeInput after loading viewer.');
        pendingProbes = null;
      }
    });

    // –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: choose... + manual selection
    resetViewerSelectBase([]);
    setViewerMessage('No fixture loaded. Use manual selection to pick fixtures/<name>.html, then QR entries to send probes into probeInput.');
  </script>
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
      navigator.serviceWorker.register('./sw.js')
        .catch(function (err) {
          console.warn('SW registration failed:', err);
        });
    });
  }
</script>
</body>
</html>

</body>
</html>

